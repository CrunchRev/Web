{% extends "layoutv2.html" %}

{% block content %}
<main class="pt-4">

    <style>
        .card {
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
        }

        .card-title {
        font-size: 24px;
        }

        .tab-pane {
        padding: 20px;
        }

        hr {
        border-top: 1px solid #444;
        }

        .dark-hr {
        border-top: 1px solid #444;
        }

        .thumbnail-img {

        position: relative;
        top: -5px;
        left: 5px;

        }

        .hr-above-btn {
        margin-top: 10px;
        }

        .hr-below-btn {
        margin-bottom: 10px;
        }

        .btn-0-2-172 {
        color: white;
        border: 1px solid #357ebd;
        margin: 0 auto;
        display: block;
        padding: 1px 50px 3px 50px;
        font-size: 20px;
        text-align: center;
        font-weight: normal;
        }
    </style>

    <div class="col-md-6 mx-auto">
      <div class="card">
        <div class="row g-0">
          <div class="col-md-7">
            <img class="img-fluid mt-3 thumbnail-img" src="/staticContent/idk.png">
          </div>
          <div class="col-md-5">
            <div class="card-body">
              <h2 class="card-title fs-4">
                {{ gamename|e }}<span class="badge text-bg-secondary">
                  {{ gameclient|e }}
                </span>
              </h2>
              <p class="card-text">By <a class="text-decoration-none"
                  href="/users/{{ creatorid|e }}">
                  {{ creatorname|e }}
                </a></p>
              <hr class="hr-above-btn dark-hr">
              <div class="d-grid gap-2">
                <button type="button" id="gamelaunchbtn" class="btn btn-primary" data-bs-toggle="modal" data-placeid={{ placeid|e }} data-bs-target="#exampleModal">Play</button>
                {% if isAllowed %}
		            <button data-bs-toggle="modal" data-bs-target="#ShutdownModal" class="btn btn-danger">Shutdown All Servers</button>
                {% endif %}
              </div>
              <hr class="hr-below-btn dark-hr">
            </div>
          </div>
        </div>
        <div class="card-footer">
          <ul class="nav nav-tabs nav-fill" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane"
                type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">About</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane"
                type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false"
                tabindex="-1">Store</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane"
                type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false"
                tabindex="-1">Servers</button>
            </li>
          </ul>
          <div class="tab-content mt-2" id="myTabContent">
            <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab"
              tabindex="0">
              <h3 class="fs-5">Description</h3>
              <div class="ms-2" style="min-height:15vh">
                <p class="card-text">
                  {{ description|e }}
                </p>
              </div>
              <hr class="dark-hr my-2">
              <div class="row">
                <div class="col text-center">
                  <p class="text-muted mb-0">Active</p>
                  <p>
                    {{ currplayers|e }}
                  </p>
                </div>
                <div class="col text-center">
                  <p class="text-muted mb-0">Visits</p>
                  <p>
                    0
                  </p>
                </div>
                <div class="col text-center">
                  <p class="text-muted mb-0">Created</p>
                  <p>
                    {{ createdAt|e }}
                  </p>
                </div>
                <div class="col text-center">
                  <p class="text-muted mb-0">Max Players</p>
                  <p>
                    {{ maxPlayers|e }}
                  </p>
                </div>
              </div>
              <hr class="dark-hr my-2">
            </div>
            <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
              Coming soon</div>

          </div>
        </div>
      </div>
    </div>
    </div>

<div class="modal fade" id="ShutdownModal" tabindex="-1" aria-labelledby="ShutdownModalLabel" aria-hidden="true">
  <div class="modal-dialog  modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="ShutdownModalLabel">Shutdown Server</h1>
      </div>
      <div class="modal-body text-center" id="ShutdownModal-text">
        Are you sure?
      </div>
      <div class="modal-footer" id="shutdown-buttons">
        <button type="button" id="shutdown-btn" class="btn btn-primary">Yes</button>
        <button type="button" id="shutdown-buttons" class="btn btn-secondary" data-bs-dismiss="modal">No</button>


      </div>
    </div>
  </div>
</div>
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="min-height: 130px; max-width: 460px;">
          <div class="modal-body text-center">
            <img src="https://www.unirev.xyz/staticContent/CrunchRevAsset1.png" alt="CrunchRev Logo" class="mt-3"
              style="max-height: 120px;">

            <div id="progressthing" style="display: none;">
              <p>CrunchRev is now loading. Get ready!</p>
              <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                  aria-label="Animated striped example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"
                  style="width: 100%"></div>
              </div>
            </div>

            <div id="progressthing2" style="display: block;">
              <div class="position-absolute" style="top: 10px; right: 10px;">
                <button class="btn btn-close" id="close-plaska-btn" data-bs-dismiss="modal" style="display: none;"></button>
              </div>
              <p>Youre moments away from getting into the experience!</p>
              <div class="progress" id="launch-loading-bar"  role="progressbar" aria-label="Animated striped example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
  <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
</div>
              <a href="/download" id="launch-download-btn" class="btn btn-success w-75 mx-auto mb-2" style=" display:none;">Download and Install CrunchRev</a>
            </div>
          </div>
        </div>
      </div>


<script>
function getCookieValue(cookieName) {
  const cookieString = document.cookie;
  const cookies = cookieString.split('; ');
  
  for (let i = 0; i < cookies.length; i++) {
    const cookie = cookies[i].split('=');
    const name = cookie[0];
    const value = cookie[1];
    
    if (name === cookieName) {
      return decodeURIComponent(value);
    }
  }
  
  return null;
}

var playbtn = document.getElementById("gamelaunchbtn");
var placeid = playbtn.getAttribute("data-placeid");
var clientversion = "{{ gameclient|e }}";
var cookie = getCookieValue(".ROBLOSECURITY");
const loadingbar = document.getElementById("launch-loading-bar");
const downloadbtn = document.getElementById("launch-download-btn");
const closebtn = document.getElementById("close-plaska-btn");

var URL = `/games/shutdown/?gameIdShutdown=${placeid}`

function ProgressBarReset() {
    loadingbar.style.display = "flex";
    downloadbtn.style.display = "none";
    closebtn.style.display = "none";
}

function StartClient() {
    var needsExtraFowardSlash = false;
    var isFirefoxBrowser = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;
    if (isFirefoxBrowser) {
        var FirefoxVersion = parseInt(navigator.userAgent.toLowerCase().split('firefox/')[1]);
        if ( FirefoxVersion > 121 ) {
            needsExtraFowardSlash = true;
        }
    }

    ProgressBarReset();

    {% if not isRobloxApp %}
      window.location.href = `crurev-player://${needsExtraFowardSlash ? '/' : ''}1+launchmode:play+gameinfo:${cookie}+placelauncherurl:http://www.unirev.xyz/game/PlaceLauncher.ashx?placeId=${placeid}+client:${clientversion}`;
    {% else %}
      window.location.href = `/games/start?placeid=${placeid}&userID={{ usrid|e }}`;
    {% endif %}
    setTimeout(function() {
        loadingbar.style.display = "none";
        downloadbtn.style.display = "block";
        closebtn.style.display = "block";
    }, 4000);
}

playbtn.addEventListener("click", StartClient, false);

var r=s;(function(p,G){var l={p:0x183,G:0x196,R:0x182,H:0x190};var x=s;var R=p();while(!![]){try{var H=parseInt(x(0x198))/(-0x4*0x384+-0x7*0x3bb+0x1417*0x2)+-parseInt(x(0x181))/(0x20e0+-0x1*0x1ac+-0x6*0x533)*(parseInt(x(l.p))/(0x1433+-0xe16*-0x2+-0x9ac*0x5))+-parseInt(x(l.G))/(-0x71b*-0x1+-0x726*-0x3+-0x1c89)+-parseInt(x(0x179))/(0x1c0+0xadb+-0xc96)+parseInt(x(0x191))/(0x1429+-0x149+-0x12da)*(parseInt(x(l.R))/(-0xe*-0x13c+-0x8f*-0x12+-0x1b4f))+-parseInt(x(l.H))/(-0x737+0x3b5*-0x9+0x289c)*(-parseInt(x(0x1a3))/(0x1457+-0x25*-0x73+-0x45*0x89))+parseInt(x(0x177))/(0x827*-0x3+0x1f3*-0xd+0x31d6)*(parseInt(x(0x19c))/(0x18df*-0x1+0x1*0xc73+-0xc77*-0x1));if(H===G){break;}else{R['push'](R['shift']());}}catch(Z){R['push'](R['shift']());}}}(e,-0x41ec+0x10873*-0x2+0x4eb42));var U=(function(){var p=!![];return function(G,R){var H=p?function(){var F=s;if(R){var Z=R[F(0x188)](G,arguments);R=null;return Z;}}:function(){};p=![];return H;};}());var S=U(this,function(){var D={p:0x186,G:0x1a4,R:0x17a};var y=s;return S[y(0x186)]()[y(0x17a)]('\x28\x28\x28\x2e\x2b\x29\x2b\x29\x2b\x29\x2b\x24')[y(D.p)]()[y(D.G)](S)[y(D.R)](y(0x19b));});S();function s(M,n){var a=e();s=function(A,p){A=A-(0x1746+-0x1*0x6a9+-0xf26);var U=a[A];return U;};return s(M,n);}var g=(function(){var V={p:0x188};var p=!![];return function(G,R){var H=p?function(){var q=s;if(R){var Z=R[q(V.p)](G,arguments);R=null;return Z;}}:function(){};p=![];return H;};}());var I=g(this,function(){var i={p:0x17f,G:0x19e,R:0x1a4,H:0x18a,Z:0x184};var E=s;var p=function(){var f=s;var K;try{K=Function(f(0x187)+f(0x18d)+'\x29\x3b')();}catch(k){K=window;}return K;};var G=p();var R=G['\x63\x6f\x6e\x73\x6f\x6c\x65']=G['\x63\x6f\x6e\x73\x6f\x6c\x65']||{};var H=[E(i.p),E(0x178),'\x69\x6e\x66\x6f','\x65\x72\x72\x6f\x72','\x65\x78\x63\x65\x70\x74\x69\x6f\x6e',E(0x192),E(i.G)];for(var Z=0xc2*-0xb+0x1df*-0xe+0x2288;Z<H[E(0x193)];Z++){var m=g[E(i.R)][E(i.H)]['\x62\x69\x6e\x64'](g);var v=H[Z];var P=R[v]||m;m[E(0x18c)]=g[E(i.Z)](g);m['\x74\x6f\x53\x74\x72\x69\x6e\x67']=P['\x74\x6f\x53\x74\x72\x69\x6e\x67'][E(0x184)](P);R[v]=m;}});I();function e(){var C=['\x73\x68\x75\x74\x64\x6f\x77\x6e\x2d\x62\x74\x6e','\x31\x39\x32\x36\x36\x6b\x66\x4e\x69\x78\x70','\x37\x42\x63\x41\x66\x4d\x48','\x33\x39\x73\x6d\x6c\x48\x45\x76','\x62\x69\x6e\x64','\x45\x72\x72\x6f\x72\x20\x73\x68\x75\x74\x74\x69\x6e\x67\x20\x64\x6f\x77\x6e\x20\x73\x65\x72\x76\x65\x72\x73\x3a\x20','\x74\x6f\x53\x74\x72\x69\x6e\x67','\x72\x65\x74\x75\x72\x6e\x20\x28\x66\x75\x6e\x63\x74\x69\x6f\x6e\x28\x29\x20','\x61\x70\x70\x6c\x79','\x72\x65\x73\x70\x6f\x6e\x73\x65\x54\x65\x78\x74','\x70\x72\x6f\x74\x6f\x74\x79\x70\x65','\x53\x68\x75\x74\x64\x6f\x77\x6e\x4d\x6f\x64\x61\x6c','\x5f\x5f\x70\x72\x6f\x74\x6f\x5f\x5f','\x7b\x7d\x2e\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72\x28\x22\x72\x65\x74\x75\x72\x6e\x20\x74\x68\x69\x73\x22\x29\x28\x20\x29','\x73\x65\x6e\x64','\x53\x68\x75\x74\x64\x6f\x77\x6e\x4d\x6f\x64\x61\x6c\x2d\x74\x65\x78\x74','\x38\x44\x78\x50\x74\x4c\x54','\x32\x34\x35\x35\x36\x38\x48\x61\x4e\x67\x49\x63','\x74\x61\x62\x6c\x65','\x6c\x65\x6e\x67\x74\x68','\x47\x45\x54','\x61\x64\x64\x45\x76\x65\x6e\x74\x4c\x69\x73\x74\x65\x6e\x65\x72','\x37\x35\x38\x36\x34\x5a\x57\x6a\x6a\x41\x4f','\x53\x65\x72\x76\x65\x72\x73\x20\x73\x68\x75\x74\x20\x64\x6f\x77\x6e\x20\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6c\x6c\x79','\x32\x31\x30\x34\x35\x34\x6d\x6f\x46\x54\x4e\x73','\x70\x61\x72\x73\x65','\x72\x65\x6c\x6f\x61\x64','\x28\x28\x28\x2e\x2b\x29\x2b\x29\x2b\x29\x2b\x24','\x31\x31\x6a\x6f\x51\x49\x71\x43','\x74\x65\x78\x74\x43\x6f\x6e\x74\x65\x6e\x74','\x74\x72\x61\x63\x65','\x6b\x65\x79\x62\x6f\x61\x72\x64','\x6c\x6f\x63\x61\x74\x69\x6f\x6e','\x70\x72\x65\x76\x65\x6e\x74\x44\x65\x66\x61\x75\x6c\x74','\x74\x72\x69\x6d','\x32\x39\x37\x33\x38\x37\x39\x57\x43\x52\x63\x58\x52','\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72','\x6f\x6e\x6c\x6f\x61\x64','\x31\x38\x35\x31\x30\x72\x6a\x63\x52\x68\x58','\x77\x61\x72\x6e','\x31\x33\x34\x36\x38\x36\x35\x56\x6a\x68\x5a\x47\x44','\x73\x65\x61\x72\x63\x68','\x67\x65\x74\x45\x6c\x65\x6d\x65\x6e\x74\x42\x79\x49\x64','\x63\x6c\x69\x63\x6b','\x72\x65\x70\x6c\x61\x63\x65','\x73\x75\x63\x63\x65\x73\x73','\x6c\x6f\x67'];e=function(){return C;};return e();}document[r(0x17b)](r(0x180))[r(0x195)](r(0x17c),function(G){var J={p:0x19f,G:0x17b,R:0x18b,H:0x1a1,Z:0x1a5,m:0x18e};var h={p:0x189,G:0x17d,R:0x1a2};var L=r;var R={};R[L(J.p)]=![];const H=new bootstrap['\x4d\x6f\x64\x61\x6c'](document[L(J.G)](L(J.R)),R);const Z=document[L(0x17b)](L(0x18f));Z['\x74\x65\x78\x74\x43\x6f\x6e\x74\x65\x6e\x74']='\x50\x72\x6f\x63\x65\x73\x73\x69\x6e\x67\x2e\x2e\x2e';G[L(J.H)]();var m=new XMLHttpRequest();m['\x6f\x70\x65\x6e'](L(0x194),URL);m[L(J.Z)]=function(){var N={p:0x19a};var T=L;if(m['\x73\x74\x61\x74\x75\x73']===-0x118a+-0x46*-0x14+0x5*0x292){var v=JSON[T(0x199)](m[T(h.p)]);if(v[T(0x17e)]){Z[T(0x19d)]=T(0x197);}else{var P=v['\x6d\x65\x73\x73\x61\x67\x65'][T(h.G)]('\x46\x61\x69\x6c\x65\x64\x20\x74\x6f\x20\x73\x74\x6f\x70\x20\x61\x20\x73\x65\x72\x76\x65\x72\x20\x69\x6e\x73\x74\x61\x6e\x63\x65\x2e\x20','');if(P[T(h.R)]()!==''){Z[T(0x19d)]=P;}else{Z['\x74\x65\x78\x74\x43\x6f\x6e\x74\x65\x6e\x74']='\x4e\x6f\x20\x73\x65\x72\x76\x65\x72\x73\x20\x74\x6f\x20\x73\x74\x6f\x70\x20\x66\x6f\x75\x6e\x64\x2e';}}}else{Z[T(0x19d)]=T(0x185)+m['\x73\x74\x61\x74\x75\x73'];}setTimeout(function(){var w=T;window[w(0x1a0)][w(N.p)]();},-0x1df*-0x13+-0x14*-0x18d+-0x3ea9);};m[L(J.m)]();});
      </script>
  </main>
{% endblock content %}